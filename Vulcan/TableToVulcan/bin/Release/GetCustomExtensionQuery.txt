Declare @cs1 nvarchar(max)
Declare @cs2 nvarchar(max)

IF OBJECT_ID('tempdb..#VulcanTMP') IS NOT NULL
    DROP TABLE #VulcanTMP
SELECT I.name, CL.name as ColumnName,is_unique,is_padded,ignore_dup_key,type,Is_Identity,is_primary_key into #VulcanTMP
FROM SYS.INDEXES I INNER JOIN SYS.INDEX_COLUMNS IC ON I.INDEX_ID=IC.INDEX_ID AND I.OBJECT_ID=IC.OBJECT_ID
INNER JOIN SYS.COLUMNS CL ON IC.COLUMN_ID = CL.COLUMN_ID AND IC.OBJECT_ID = CL.OBJECT_ID
WHERE IC.object_id=object_id('@Schema.@Table') and is_disabled=0

--add CustomerExtension
IF(SELECT COUNT(DISTINCT is_identity) FROM #VulcanTMP WHERE is_primary_key= 1) >1
	SELECT @cs1=
			'IF EXISTS(select * from sys.all_objects where name=N'''+name+''' and type=N''PK'')
					    ALTER TABLE '+'@Schema'+'.'+'@Table'+' Drop constraint '+a.name+'
						ALTER TABLE '+'@Schema'+'.'+'@Table'+' Add constraint '+a.name+' Primary Key ('+STUFF((
					SELECT ','+ColumnName AS [text()] 
					FROM #VulcanTMP b 
					WHERE a.name=b.name
					FOR XML PATH ('')),1,1,'')+')'
			     
	FROM #VulcanTMP a WHERE is_primary_key = 1 
	GROUP BY a.name

	
SELECT  @cs2=
  REPLACE(REPLACE(REPLACE(REPLACE(REPLACE('IF EXISTS(select * from sys.all_objects where name=N''@IXN'' and type=N''UQ'')
					      ALTER TABLE @Schm.@TBNM
					      Drop constraint @IXN

					      Create UNIQUE INDEX @IXN ON Dim.@TBNM(@CNM)
					      where @fd','@IXN',ind.name),'@TBNM',t.name),'@CNM',col.name),'@fd',filter_definition),'@Schm','@Schema')
FROM 
     sys.indexes ind 
INNER JOIN 
     sys.index_columns ic ON  ind.object_id = ic.object_id and ind.index_id = ic.index_id 
INNER JOIN 
     sys.columns col ON ic.object_id = col.object_id and ic.column_id = col.column_id 
INNER JOIN 
     sys.tables t ON ind.object_id = t.object_id 
WHERE 
	 T.NAME  = '@Table'
	 AND schema_id = schema_id('@Schema') AND filter_definition IS NOT NULL
ORDER BY 
     t.name, ind.name, ind.index_id, ic.index_column_id 

IF @cs1 IS NULL AND @cs2 IS NULL 
	SELECT ''
ELSE
	SELECT ISNULL(@cs1,'') 
	UNION ALL
	SELECT ISNULL(@cs2,'')
		