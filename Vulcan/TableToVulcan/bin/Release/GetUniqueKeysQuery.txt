IF OBJECT_ID('tempdb..#VulcanTMP') IS NOT NULL
    DROP TABLE #VulcanTMP
SELECT I.name, CL.name as ColumnName,is_unique,is_padded,ignore_dup_key,type,is_Identity into #VulcanTMP
FROM SYS.INDEXES I INNER JOIN SYS.INDEX_COLUMNS IC ON I.INDEX_ID=IC.INDEX_ID AND I.OBJECT_ID=IC.OBJECT_ID
INNER JOIN SYS.COLUMNS CL ON IC.COLUMN_ID = CL.COLUMN_ID AND IC.OBJECT_ID = CL.OBJECT_ID
WHERE IC.object_id=object_id('@Schema.@Table') and is_disabled=0


IF Exists(SELECT 1 FROM #VulcanTMP WHERE is_unique=1 and type=2)
SELECT	'<UniqueKey Name="'+CAST(name AS nvarchar(255))+'" Unique="'
						+CASE is_unique WHEN 1 THEN 'true' WHEN 0 THEN 'false' END
						+'" Clustered="'+CASE type WHEN 1 THEN 'true' WHEN 2 THEN 'false' END
						+'" IgnoreDupKey="'+CASE ignore_dup_key WHEN 1 THEN 'true' WHEN 0 THEN 'false' END 
						+'" PadIndex="'+CASE is_padded WHEN 1 THEN 'true' WHEN 0 THEN 'false' END +'">
				<Columns>
					'+ REPLACE(REPLACE((SELECT '<Column ColumnName="'+ColumnName+'"/> ' AS [text()] 
							FROM #VulcanTMP b 
							WHERE a.name=b.name
							FOR XML PATH ('')),'&lt;','<'),'&gt;','>') +'
				</Columns>
			</UniqueKey>' AS UK
	FROM #VulcanTMP a WHERE Is_Identity=0 AND type=2  AND is_unique=1
	GROUP BY a.name,is_unique,ignore_dup_key,is_padded,type
